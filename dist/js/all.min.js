jQuery(document).ready(function(e){function a(){var e=document.getElementById("gnom"),a=e.getContext("2d"),t=new Image;t.src="dist/images/gnom.png",t.onload=function(){a.drawImage(t,0,0)}}function t(){var e=document.getElementById("eyes"),a=e.getContext("2d"),t=new Image;t.src="dist/images/close-eyes.png",t.onload=function(){setInterval(function(){a.drawImage(t,0,0),setTimeout(function(){a.clearRect(0,0,65,12)},100)},4e3)}}function n(){var e=document.getElementById("nose"),a=e.getContext("2d"),t=new Image;t.src="dist/images/nose.png",t.onload=function(){setInterval(function(){a.drawImage(t,0,0),setTimeout(function(){a.clearRect(0,0,60,44)},200)},12200)}}function s(){var e=document.getElementById("gnom-message"),a=e.getContext("2d");a.globalCompositeOperation="destination-over";var t=new Image;t.src="dist/images/message-box.png",t.onload=function(){a.drawImage(t,0,0)}}function i(e){var a=document.getElementById(e),t=a.getContext("2d"),n=new Image;n.src="dist/images/chest-empty.png",n.onload=function(){t.drawImage(n,0,0,123,113,0,0,123,113)}}function o(){e("#buy-games-btn").removeClass("btn-disable").addClass("btn-active"),e("#buy-games").val(b)}function l(a){b<1?e("#buy-games-btn").addClass("btn-disable").removeClass("btn-active"):b--}function c(){e("#sum").val(50*b)}function d(){var a=parseInt(e("#all-cash").val());allCash=a-50*b,e("#all-cash").val(parseInt(allCash))}function m(){h+=b,b=0,e("#sum").val(0),e("#buy-games").val(0),e("#open-games").val(h)}function u(){h>0&&e("#game-start").removeClass("btn-disable").addClass("btn-active")}function r(e,a){var t;t=1===a?"dist/images/chest-gold.png":"dist/images/chest-empty.png";var n=document.getElementById(e),s=n.getContext("2d");s.fillStile="transparent";var i=new Image;i.src=t,i.onload=function(){s.drawImage(i,0,0,123,113,0,0,123,113)};var o=0;setInterval(function(){o<3?(s.clearRect(0,0,123,113),s.drawImage(i,123*o,0,123,113,0,0,123,113),o++):clearInterval()},30)}function v(){var a=e(".game-control").position(),t=e(window).width();e("#game-control-bg").width(t-a.left+5)}function g(){e(".chest-item").removeClass("open"),p=C=0;for(var a=0;a<9;a++){var t="chest"+a;i(t)}}function f(){h>0?e("#game-start").toggleClass("btn-disable : btn-active"):parseInt(e("#all-cash").val())>50&&(e("#buy-games-btn").toggleClass("btn-disable : btn-active"),setTimeout(function(){e("#buy-games-btn").toggleClass("btn-disable : btn-active")},2e3))}var b=parseInt(e("#buy-games").val()),h=parseInt(e("#open-games").val());t(),n(),s(),function(){for(var a=0;a<9;a++){var t="chest"+a,n="<div class='chest-item'><canvas id='"+t+"' width='123' height='113'></canvas></div>";e(".game-field-chests-container").append(n),i(t)}}(),a(),e(document).on("input","#buy-games",function(a){var t=e(this).val(),n=parseInt(e("#all-cash").val()/50);t>n?e(this).val(n):0===parseInt(t)?e(this).val(""):isNaN(parseInt(t))&&(a.preventDefault(),e(this).val(""))}),e(document).on("focusin","#buy-games",function(a){0===parseInt(e(this).val())&&e(this).val("")}),e(document).on("focusout","#buy-games",function(a){var t=parseInt(e(this).val());isNaN(t)?(e(this).val(0),b=0,e("#sum").val(0),l()):(b=t,e("#sum").val(50*b),e("#buy-games-btn").hasClass("btn-disable")&&e("#buy-games-btn").removeClass("btn-disable").addClass("btn-active"))}),e(".add-game").click(function(a){50*b+50>parseInt(e("#all-cash").val())?a.preventDefault():(b++,o(),c())}),e(".remove-game").click(function(a){0===b?a.preventDefault():1===b?(b--,l()):b--,e("#buy-games").val(b),c()}),e("#buy-games-btn").click(function(a){return!e(this).hasClass("btn-disable")&&(d(),m(),e(this).addClass("btn-disable").removeClass("btn-active"),u(),void 0)}),e("#game-start").click(function(a){return!e(this).hasClass("btn-disable")&&(h--,e("#open-games").val(h),e(".chest-item").addClass("active"),e(this).addClass("btn-disable").removeClass("btn-active"),e("#buy-games-count").addClass("close"),void 0)});var p=0,C=0;e(".chest-item").click(function(a){if(e(this).hasClass("active")&&e(this).hasClass("open")===!1){var t=e(".chest-item").index(e(this)),n="chest"+t;e(this).addClass("open"),p++,0===t||1===t||2===t?(r(n,1),C++):r(n,0)}else e(this).hasClass("active")&&e(this).hasClass("open")&&a.preventDefault();3===p&&3===C?(e(this).parent().find(".chest-item").removeClass("active"),e("#success-modal-window").fadeIn(500,function(){setTimeout(function(){var a=e("#all-cash").val();g(),e("#success-modal-window").fadeOut(600),e("#all-cash").val(parseInt(a)+1e3),e("#buy-games-count").removeClass("close"),f()},2e3)})):3===p&&3!==C&&(e(this).parent().find(".chest-item").removeClass("active"),e("#lose-modal-window").fadeIn(500,function(){setTimeout(function(){g(),e("#lose-modal-window").fadeOut(600),e("#buy-games-count").removeClass("close"),f()},2e3)}))}),e(".user-login-link").click(function(a){a.preventDefault(),e("#login-modal-window").fadeIn(300)}),e(".login-modal-close").click(function(){e("#login-modal-window").fadeOut(300)}),e(window).resize(v),v()});